<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>School login / ADMIN</title>

  <!-- Favicon & Touch Icon -->
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="apple-touch-icon" href="PHS-LOGO.png">

  <!-- CSS -->
  <link rel="stylesheet" href="style.css">

  <!-- ‚úÖ ‡¶∏‡ßá‡¶∂‡¶® ‡¶ö‡ßá‡¶ï -->
<script>
  if (sessionStorage.getItem("userType") !== "school") {
    window.location.replace("index.html");
  }
</script>
  <style>
        /* Additional styles for dynamic content if needed */
        .editable-cell {
            background-color: #f0f0f0; /* ‡¶π‡¶æ‡¶≤‡¶ï‡¶æ ‡¶ß‡ßÇ‡¶∏‡¶∞ ÿßŸÑÿÆŸÑŸÅŸäÿ© ‡¶Ø‡¶ñ‡¶® ‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá */
        }
        .fixed-class-cell {
            font-weight: bold;
        }
        /* ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶∏‡ßç‡¶™‡¶ø‡¶®‡¶æ‡¶∞ */
        .loader {
            border: 5px solid #f3f3f3; /* Light grey */
            border-top: 5px solid #3498db; /* Blue */
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶™‡ßç‡¶∞‡¶¶‡¶∞‡ßç‡¶∂‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
        .message-toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 20px;
            border-radius: 5px;
            color: white;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        .message-toast.show {
            opacity: 1;
        }
        .message-toast.success {
            background-color: #28a745; /* ‡¶∏‡¶¨‡ßÅ‡¶ú */
        }
        .message-toast.error {
            background-color: #dc3545; /* ‡¶≤‡¶æ‡¶≤ */
        }
    </style>
</head>


 
<body class="bg-gray-100 font-sans">

  <!-- ‚úÖ School Branding -->
  <img src="PHS-LOGO.png" alt="SCHOOL LOGO" class="logo">
  <h1>PATHPUKUR HIGH SCHOOL (HS)</h1>
  <h2 class="blink">üë§ <u>School login</u> üë§ </h2>


    
    

    
    

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <header class="mb-6 text-center">
            <h1 class="text-2xl sm:text-3xl font-bold text-gray-700">‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶ï‡¶¶‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</h1>
        </header>

        <div id="loader" class="loader" style="display: none;"></div>
        <div id="messageToast" class="message-toast"></div>

        <div class="overflow-x-auto bg-white shadow-md rounded-lg">
            <table class="min-w-full leading-normal">
                <thead>
                    <tr class="custom-heading-bg text-white">
                        <th class="px-3 sm:px-5 py-3 border-b-2 border-gray-200 text-left text-xs sm:text-sm font-semibold uppercase tracking-wider">CLASS</th>
                        <th class="px-3 sm:px-5 py-3 border-b-2 border-gray-200 text-left text-xs sm:text-sm font-semibold uppercase tracking-wider">ID</th>
                        <th class="px-3 sm:px-5 py-3 border-b-2 border-gray-200 text-left text-xs sm:text-sm font-semibold uppercase tracking-wider">PASSWORD</th>
                        <th class="px-3 sm:px-5 py-3 border-b-2 border-gray-200 text-left text-xs sm:text-sm font-semibold uppercase tracking-wider">LINK</th>
                        <th class="px-3 sm:px-5 py-3 border-b-2 border-gray-200 text-left text-xs sm:text-sm font-semibold uppercase tracking-wider">‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡ßç‡¶∞‡¶Æ</th>
                    </tr>
                </thead>
                <tbody id="linkTableBody">
                    </tbody>
            </table>
        </div>
    </div>

    <script>
        // Google Apps Script Web App URL (‡¶è‡¶ü‡¶ø ‡¶ß‡¶æ‡¶™ ‡ß® ‡¶•‡ßá‡¶ï‡ßá ‡¶™‡¶æ‡¶¨‡ßá‡¶®)
        const WEB_APP_URL = '‡¶Ü‡¶™‡¶®‡¶æ‡¶∞_APPS_SCRIPT_WEB_APP_URL_‡¶è‡¶ñ‡¶æ‡¶®‡ßá_‡¶¶‡¶ø‡¶®';

        const classes = [
            "V_1ST", "V_2ND", "V_3RD",
            "VI_1ST", "VI_2ND", "VI_3RD",
            "VII_1ST", "VII_2ND", "VII_3RD",
            "VIII_1ST", "VIII_2ND", "VIII_3RD",
            "IX_1ST", "IX_2ND", "IX_3RD",
            "X_1ST", "X_2ND", "X_3RD",
            "X_TEST_EXAM"
        ];

        const tableBody = document.getElementById('linkTableBody');
        const loader = document.getElementById('loader');
        const messageToast = document.getElementById('messageToast');

        // ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        function showToast(message, type = 'success') {
            messageToast.textContent = message;
            messageToast.className = `message-toast ${type} show`;
            setTimeout(() => {
                messageToast.className = 'message-toast';
            }, 3000); // ‡ß© ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶™‡¶∞ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶≤‡ßÅ‡¶ï‡¶æ‡¶§‡ßá
        }

        // ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        async function loadData() {
            loader.style.display = 'block';
            tableBody.innerHTML = ''; // ‡¶™‡ßÅ‡¶∞‡¶æ‡¶§‡¶® ‡¶°‡ßá‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ

            try {
                const response = await fetch(`${WEB_APP_URL}?action=get`);
                if (!response.ok) throw new Error(`Network response was not ok: ${response.statusText}`);
                const result = await response.json();

                if (result.success) {
                    const existingDataMap = new Map();
                    if (Array.isArray(result.data)) {
                        result.data.forEach(item => {
                            if(item.CLASS) { // ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶® CLASS ‡¶Ü‡¶õ‡ßá
                                existingDataMap.set(item.CLASS.trim(), item);
                            }
                        });
                    }
                    
                    classes.forEach(className => {
                        const data = existingDataMap.get(className) || { CLASS: className, ID: '', PASSWORD: '', LINK: '' };
                        createRow(data);
                    });
                } else {
                    showToast(result.message || '‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡ßü‡ßá‡¶õ‡ßá', 'error');
                }
            } catch (error) {
                console.error('Error loading data:', error);
                showToast(`‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶Æ‡ßü ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ${error.message}`, 'error');
                // ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø‡¶∞ ‡¶ï‡ßç‡¶∑‡ßá‡¶§‡ßç‡¶∞‡ßá ‡¶ñ‡¶æ‡¶≤‡¶ø ‡¶∞‡ßã ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ
                classes.forEach(className => {
                    createRow({ CLASS: className, ID: '', PASSWORD: '', LINK: '' });
                });
            } finally {
                loader.style.display = 'none';
            }
        }

        // ‡¶ü‡ßá‡¶¨‡¶ø‡¶≤‡ßá‡¶∞ ‡¶∏‡¶æ‡¶∞‡¶ø ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        function createRow(data) {
            const row = tableBody.insertRow();
            row.className = 'hover:bg-green-100 custom-row-hover'; // ‡¶π‡ßã‡¶≠‡¶æ‡¶∞ ‡¶á‡¶´‡ßá‡¶ï‡ßç‡¶ü

            // CLASS ‡¶∏‡ßá‡¶≤ ( ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø ‡¶®‡ßü )
            const classCell = row.insertCell();
            classCell.textContent = data.CLASS;
            classCell.className = 'px-3 sm:px-5 py-3 border-b border-gray-200 bg-green-400 text-white text-sm fixed-class-cell'; // ‡¶π‡¶æ‡¶≤‡¶ï‡¶æ ‡¶∏‡¶¨‡ßÅ‡¶ú ÿßŸÑÿÆŸÑŸÅŸäÿ©, ‡¶∏‡¶æ‡¶¶‡¶æ ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü

            // ID, Password, Link ‡¶∏‡ßá‡¶≤ ( ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø )
            const idCell = createEditableCell(data.ID || '');
            row.appendChild(idCell);

            const passwordCell = createEditableCell(data.PASSWORD || '');
            row.appendChild(passwordCell);
            
            const linkCell = createEditableCell(data.LINK || '');
            row.appendChild(linkCell);

            // ‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡ßç‡¶∞‡¶Æ ‡¶∏‡ßá‡¶≤
            const actionCell = row.insertCell();
            actionCell.className = 'px-3 sm:px-5 py-3 border-b border-gray-200 bg-white text-sm';
            
            const editButton = createButton('Edit', 'bg-blue-500 hover:bg-blue-700', () => enableEdit(row, editButton, saveButton));
            const saveButton = createButton('Save', 'bg-green-500 hover:bg-green-700', () => saveData(row, data.CLASS, editButton, saveButton));
            saveButton.style.display = 'none'; // ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶∏‡ßá‡¶≠ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®‡ßã ‡¶•‡¶æ‡¶ï‡¶¨‡ßá
            
            const deleteButton = createButton('Delete', 'bg-red-500 hover:bg-red-700 ml-2', () => deleteData(data.CLASS, row));

            actionCell.appendChild(editButton);
            actionCell.appendChild(saveButton);
            actionCell.appendChild(deleteButton);
        }

        function createEditableCell(text) {
            const cell = document.createElement('td');
            cell.textContent = text;
            cell.className = 'px-3 sm:px-5 py-3 border-b border-gray-200 bg-white text-sm';
            cell.setAttribute('data-original-text', text); // ‡¶Ü‡¶∏‡¶≤ ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£
            return cell;
        }
        
        function createButton(text, classes, onClick) {
            const button = document.createElement('button');
            button.textContent = text;
            button.className = `text-white font-bold py-1 px-2 sm:py-2 sm:px-3 rounded text-xs sm:text-sm ${classes}`;
            button.onclick = onClick;
            return button;
        }

        // ‡¶è‡¶°‡¶ø‡¶ü ‡¶Æ‡ßã‡¶° ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶ï‡¶∞‡¶æ
        function enableEdit(row, editBtn, saveBtn) {
            // ID, PASSWORD, LINK ‡¶∏‡ßá‡¶≤‡¶ó‡ßÅ‡¶≤‡ßã (index 1, 2, 3)
            for (let i = 1; i <= 3; i++) {
                const cell = row.cells[i];
                cell.contentEditable = true;
                cell.classList.add('editable-cell', 'border-blue-300', 'ring-1', 'ring-blue-300'); // ‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶Æ‡ßü ‡¶á‡¶®‡¶°‡¶ø‡¶ï‡ßá‡¶ü‡¶∞
                cell.focus();
            }
            editBtn.style.display = 'none';
            saveBtn.style.display = 'inline-block';
        }

        // ‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ
        async function saveData(row, className, editBtn, saveBtn) {
            loader.style.display = 'block';
            const cells = row.cells;
            const updatedData = {
                CLASS: className,
                ID: cells[1].textContent.trim(),
                PASSWORD: cells[2].textContent.trim(),
                LINK: cells[3].textContent.trim()
            };

            try {
                const response = await fetch(WEB_APP_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain;charset=utf-8', // Apps Script ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø text/plain ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶≠‡¶æ‡¶≤‡ßã
                    },
                    body: JSON.stringify({ action: 'save', data: updatedData })
                });
                if (!response.ok) throw new Error(`Network response was not ok: ${response.statusText}`);
                const result = await response.json();

                if (result.success) {
                    showToast('‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡ßá‡¶≠ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
                    for (let i = 1; i <= 3; i++) { // ID, PASSWORD, LINK
                        cells[i].contentEditable = false;
                        cells[i].classList.remove('editable-cell', 'border-blue-300', 'ring-1', 'ring-blue-300');
                        cells[i].setAttribute('data-original-text', cells[i].textContent.trim()); // ‡¶®‡¶§‡ßÅ‡¶® ‡¶Ü‡¶∏‡¶≤ ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
                    }
                    editBtn.style.display = 'inline-block';
                    saveBtn.style.display = 'none';
                } else {
                    showToast(result.message || '‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá', 'error');
                    // ‡¶∏‡ßá‡¶≠ ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶≤‡ßá ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶Ø‡¶º ‡¶´‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡ßá ‡¶Ü‡¶®‡¶æ
                    for (let i = 1; i <= 3; i++) {
                         cells[i].textContent = cells[i].getAttribute('data-original-text');
                    }
                }
            } catch (error) {
                console.error('Error saving data:', error);
                showToast(`‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶Æ‡ßü ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ${error.message}`, 'error');
                 for (let i = 1; i <= 3; i++) {
                     cells[i].textContent = cells[i].getAttribute('data-original-text');
                 }
            } finally {
                loader.style.display = 'none';
            }
        }
        
        // ‡¶°‡ßá‡¶ü‡¶æ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ
        async function deleteData(className, rowElement) {
            if (!confirm(`‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø "${className}" ‡¶è‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?`)) {
                return;
            }
            loader.style.display = 'block';
            try {
                const response = await fetch(WEB_APP_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain;charset=utf-8',
                    },
                    body: JSON.stringify({ action: 'delete', class: className })
                });
                if (!response.ok) throw new Error(`Network response was not ok: ${response.statusText}`);
                const result = await response.json();

                if (result.success) {
                    showToast('‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
                    // UI ‡¶•‡ßá‡¶ï‡ßá ‡¶°‡ßá‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ (‡¶∏‡ßá‡¶≤‡¶ó‡ßÅ‡¶≤‡ßã ‡¶ñ‡¶æ‡¶≤‡¶ø ‡¶ï‡¶∞‡¶æ)
                    rowElement.cells[1].textContent = ''; // ID
                    rowElement.cells[2].textContent = ''; // PASSWORD
                    rowElement.cells[3].textContent = ''; // LINK
                     for (let i = 1; i <= 3; i++) {
                        rowElement.cells[i].setAttribute('data-original-text', ''); // ‡¶Ü‡¶∏‡¶≤ ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶ñ‡¶æ‡¶≤‡¶ø ‡¶ï‡¶∞‡¶æ
                    }
                } else {
                    showToast(result.message || '‡¶°‡ßá‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá', 'error');
                }
            } catch (error) {
                console.error('Error deleting data:', error);
                showToast(`‡¶°‡ßá‡¶ü‡¶æ ‡¶Æ‡ßã‡¶õ‡¶æ‡¶∞ ‡¶∏‡¶Æ‡ßü ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ${error.message}`, 'error');
            } finally {
                loader.style.display = 'none';
            }
        }

        // ‡¶™‡ßÉ‡¶∑‡ßç‡¶†‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ì‡ßü‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶æ‡¶•‡ßá ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ
        document.addEventListener('DOMContentLoaded', loadData);
    </script>
  


  
  <!-- Footer -->
  <footer>
    <hr>
    ‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡¶æ‡¶≤‡¶Ø‡¶º ‡¶™‡ßç‡¶∞‡¶ß‡¶æ‡¶®‡ßá‡¶∞ ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡ßá‡¶∂‡¶®‡¶æ‡¶Ø‡¶º, ‡¶™‡¶æ‡¶§‡¶™‡ßÅ‡¶ï‡ßÅ‡¶∞ ‡¶π‡¶æ‡¶á ‡¶∏‡ßç‡¶ï‡ßÅ‡¶≤ (‡¶â‡¶É ‡¶Æ‡¶æ‡¶É)
  </footer>

  <!-- Main JS -->
  <script src="script.js"></script>
</body>
</html>
